<tool id="tool_beta" name="Local contributions to beta diversity" version="@VERSION@" profile="20.01">
    <description>Computes beta diversity</description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <requirements> 
        <requirement type="package" version="3.3.3">r-ggplot2</requirement>
        <requirement type="package" version="2.5_7">r-vegan</requirement>
        <requirement type="package" version="0.3_14">r-adespatial</requirement>
        <requirement type="package" version="3.1.3">r-tibble</requirement>
        <requirement type="package" version="1.0.7">r-dplyr</requirement>
        <requirement type="package" version="1.1.3">r-tidyr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript
         '$__tool_directory__/graph_lcbd.r'
          '$input'
          '$colnames'
          '$abundance'
          '$location'
          #if $graph.map == 'true':
            '$graph.latitude'
            '$graph.longitude'
          #else:
            ''
            ''
          #end if
          '$species'
          '$date'
          #if $method.type == 'Separation':
            'TRUE'
            'FALSE'
            '$method.variable'
          #elif $method.type == 'Nothing':
            'FALSE'
            'TRUE'
            ''
          #end if
         '$__tool_directory__/functions.r'
          '$output_lcbd'
          '$output_scbd'
          '$plots'
        ]]>
        </command>
        <inputs>
            <expand macro="explo_input"/>
            <param name="abundance" label="Select column with abundances" type="data_column" data_ref="input" numerical="true" multiple="false" use_header_names="true"/>
            <param name="location" label="Select column with locations" type="data_column" data_ref="input" multiple="false" use_header_names="true"/>
            <param name="species" label="Select column containing species" type="data_column" data_ref="input" multiple="false" use_header_names="true"/>
            <param name="date" label="Select column containing dates" type="data_column" data_ref="input" multiple="false" use_header_names="true"/>
            <conditional name="graph">
                <param name="map" label="Would you like a spatialized representation ?" type="boolean"/>
                <when value="true">
                    <param name="latitude" label="Select column containing latitudes" type="data_column" data_ref="input" multiple="false" use_header_names="true"/>
                    <param name="longitude" label="Select column containing longitudes" type="data_column" data_ref="input" multiple="false" use_header_names="true"/>
                </when>
                <when value="false">
                </when>
            </conditional>
            <conditional name="method">
                <param name="type" type="select" label="Other LCBD">
                    <option value="Separation">Separation to construct a new lcbd graph</option>
                    <option value="Nothing">Don't want to do another graph</option>
                </param>
                <when value="Separation">
                    <param name="variable" type="data_column" data_ref="input" label="Select a column to make another graph according to the separation of the variable you choose" use_header_names="true"/>
                </when>
                <when value="Nothing"/>
            </conditional>
        </inputs>
        <outputs>
            <data name="output_lcbd" from_work_dir="LCBD.txt" format="txt" label="LCBD"/>
            <data name="output_scbd" from_work_dir="SCBD.txt" format="txt" label="Which species have a SCBD larger than the mean SCBD?"/>
            <collection type="list" name="plots">
                <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" visible="false" format="png"/>
            </collection>
        </outputs>
        <tests>
            <test>
                <param name="input" value="Reel_life_survey_fish_modif.tabular"/>
                <param name="colnames" value="true"/>
                <param name="abundance" value="18"/>
                <param name="location" value="20"/>
                <conditional name="graph">
                    <param name="map" value="true"/>
                    <param name="latitude" value="9"/>
                    <param name="longitude" value="10"/>
                </conditional>
                <param name="species" value="15"/>
                <param name="date" value="11"/>
                <conditional name="method">
                    <param name="type" value="Separation"/>
                    <param name="variable" value="16"/>
                </conditional>
                <output name="output_lcbd" value="LCBD.txt"/>
                <output name="output_scbd" value="SCBD.txt"/>
                <output_collection name="plots" type="list" count="5">
                    <element name="Beta_diversity_ext" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                    <element name="Spatio_temp" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                    <element name="Time" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                    <element name="Taxon" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                    <element name="Radar_plot" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                </output_collection>
            </test>
        </tests>
        <expand macro="topic"/>  
        <help><![CDATA[
=======================
Computes beta diversity 
=======================

**What it does**

This tool computes the beta diversity of the data :

- Computes two tables : LCBD comparative indicators of the ecological uniqueness of the sites and SCBD degree of variation of individual species across the study area
- 3, 4 or 5 graph according to what you choose


**Input description**

A tabular file with observation data. Must at least contain four columns
which associate abundance, sites, dates and species ID.

+------------+-----------+--------------+------------+
|  abundance |   dates   | species.code |    site    |
+============+===========+==============+============+
|    2       |    2014   |   speciesID  |            |
+------------+-----------+--------------+------------+
|    ...     |    ...    |      ...     |    ...     |
+------------+-----------+--------------+------------+


**Output**

A text and png files. The text file contains a table with information on the beta diversity and the png file shows multiple graph according to one type of variable in order to vizualize the beta diversity.
|

    ]]></help>
    
<expand macro="book_bibref"/>

</tool>
