<tool id="ecology_pres_abs" name="Presence absence count" version="@VERSION@" profile = "20.01">
    <description>Show if a specie is present or not and in which proportion</description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <expand macro="Explo_requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        Rscript
            '$__tool_directory__/graph_pres_abs_count.r'
            '$input'
            '$colnames'
            '$site'
            '$species'
            '$abundance'
            '$output_pa'
            '$plots'
        ]]>
        </command>
        <inputs>
            <expand macro="explo_input"/>
            <param name="site" label="Select column containing sites " type="data_column" data_ref="input"/>
            <param name="species" label="Select column containing species " type="data_column" data_ref="input" numerical="False"/>
            <param name="abundance" label="Select column containing abundances " type="data_column" data_ref="input" numerical="True"/>
        </inputs>
        <outputs>
            <data name="output_pa" from_work_dir="Locations.tabular" format="tabular"/>
            <collection type="list" name="plots">
                <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" visible="false" format="png"/>
            </collection>
        </outputs>
        <tests>
            <test>
                <param name="input" value="Reel_life_survey_fish_modif2.tabular"/>
                <param name="colnames" value="true"/>
                <param name="site" value="6"/>
                <param name="species" value="15"/>
                <param name="abundance" value="18"/>
                <output name="output_pa" value="test_fish2.tabular"/>
                <output_collection name="plots" type="list" count="1">
                    <element name="number" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                </output_collection>  
            </test>
        </tests>
        <expand macro="topic"/>
        <help><![CDATA[
==================================
Count the presence absence species
==================================

**What it does**
This tool computes the number of appearances of each specie, it counts it presence absence, according to a variable (location for instance):

- Computes one graph

**Input description**
A tabular file with observation data. Must at least contain two columns
which associate species with a variable.

+--------------+------------+------------+
| species.code |  variable  |    number  |
+==============+============+============+
|   speciesID  |    site    |      4     |
+--------------+------------+------------+
|      ...     |     ...    |     ...    |
+--------------+------------+------------+


**Output**
A  png file with one graphic showing barplots according to the variable divided in multiple colors according to species.

.. image::fish_test.png

    ]]></help>
<citations>

</citations>    
                
            
</tool>
