<tool id="ecology_PCA" name="Principal composante analysis" version="@VERSION@" profile = "20.01">
    <description>Plot a PCA</description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <requirements> 
        <requirement type="package" version="3.3.3">r-ggplot2</requirement>
        <requirement type="package" version="0.1.3">r-ggcorrplot</requirement>        
        <requirement type="package" version="2.4">r-factominer</requirement>
        <requirement type="package" version="1.0.7">r-factoextra</requirement>
        <requirement type="package" version="1.0.5">r-dplyr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript
            '$__tool_directory__/graph_pca.r'
            '$input'
            '$colnames' 
            '$columns'
            '$output_acp'
            '$plots'
        ]]>
        </command>
        <inputs>
            <expand macro="explo_input"/>
            <param name="columns" label="Select columns containing numerical values " type="data_column" data_ref="input" numerical="True" multiple="True"/>
        </inputs>
        <outputs>
            <data name="output_acp" from_work_dir="valeurs.txt" format="txt"/>
            <collection type="list" name="plots">
                <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" visible="false" format="png"/>
            </collection>
        </outputs>
        <tests>
            <test>
                <param name="input" value="Reel_life_survey_fish_modif2.tabular"/>
                <param name="colnames" value="true"/>
                <param name="columns" value="2,3,9,10,12,17,18"/>
                <output name="output_acp" value="test_value_fish2.txt"/>
                <output_collection name="plots" type="list" count="2">
                    <element name="circle" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                    <element name="quality" ftype="png">
                        <assert_contents>
                            <has_text text="PNG"/>
                        </assert_contents>
                    </element>
                </output_collection> 
            </test>
         </tests>
         <expand macro="topic"/>
         <help><![CDATA[
===========
Plots a PCA 
===========

**What it does**
This tool computes a principal composante analisys :

- Computes 2 graphs

**Input description**
A tabular file with observation data. 
whith numerical variables.

+----------+-----------+--------------+
|variable 1| variable 2| species.code |
+==========+===========+==============+
|    2     |     4     |   speciesID  |
+----------+-----------+--------------+
|  ...     |    ...    |      ...     |
+----------+-----------+--------------+

**Output**
A png file with 2 graphs. The first one is a showing a circle with the correlation between variables :

- The poisitively correlated variables are grouped together.

- The negatively ones are on opposite sides of the graph's origin.

- the distance between the variables and th origin calculates the quality of the representation of the variables. The variables far from the orignin are well represented by the PCA.  

The second graph is the oe bout the quality :

- A high cos2 indicates a good representation of the variable. In this case, the variable is near the circumference of the correlation circle.

- A low cos2 indicates that the variable is not perfectly represented. In this case, the variable is near the center of the circle.


    ]]></help>
    
<expand macro="book_bibref"/>
            
</tool>
